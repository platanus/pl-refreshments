<div class="main-page">
  <%= render 'shared/navigation' %>

  <div class="product-form">
    <h3 class="product-form__title"> Formulario de Producto </h3>
    <%= form_for @user_product, class: 'product-form__form' do |f| %>

      <%= render "shared/errors", resource: @user_product, extra_classes: 'product-form__alert' %>

      <% if @user_product.new_record? %>
        <div class="product-form__field">
          <%= f.label :name, 'Nombre', { class: 'product-form__label' } %>
          <%= f.text_field :name, { class: 'product-form__input', error: false } %>
        </div>
      <% end %>

      <% if @user_product.persisted? %>
        <div
          id="<%= "image-modal-holder-#{@user_product.id}" %>"
          class="modal hide fade"
          role="dialog"
          aria-labelledby="basicModal"
          aria-hidden="true"
        >
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h4> Imagen del Producto </h4>
                <button
                  type="button"
                  class="close"
                  data-dismiss="modal"
                  aria-hidden="true"
                >
                  ×
                </button>
              </div>
              <div class="modal-body">
                <%= @user_product.image.attached? ?
                  image_tag(url_for(@user_product.image),
                  class: 'image-modal__image')
                  : 'El producto no tiene imagen'
                %>
              </div>
            </div>
          </div>
        </div>

        <div class="product-form__field">
          <%= @user_product.image.attached? ?
            image_tag(
              url_for(@user_product.image),
              class: 'product-form__preview-image',
              data: {
                toggle: "modal",
                target: "#image-modal-holder-#{@user_product.id}"
              }
            ) : 'N/A'
          %>
        </div>
      <% end %>

      <div class="product-form__field">
        <%= f.label :price, 'Precio', { class: 'product-form__label' } %>
        <%= f.number_field :price, { class: 'product-form__input product-form__input--number', error: false } %>
      </div>

      <div class="product-form__field">
        <%= f.label :stock, 'Stock', { class: 'product-form__label' } %>
        <%= f.number_field :stock, { class: 'product-form__input product-form__input--number', error: false } %>
      </div>

      <div class="product-form__field">
        <%= f.label :category, 'Categoría', { class: 'product-form__label' } %>
        <%= f.select(:category,
          UserProduct.categories.keys.map{|category| [category.titleize, category]},
          {},
          { class: 'product-form__input product-form__input--select', error: false })
          %>
      </div>

      <% if @user_product.new_record? %>
        <div class="product-form__field">
          <%= f.label :image, 'Elige una foto', { class: 'product-form__label product-form__label--image' } %>
          <%= f.file_field :image, { class: 'product-form__input product-form__input--image', error: false } %>
        </div>
      <% end %>

      <div class="product-form__field">
        <%= link_to 'Volver',
          user_products_path,
          class: 'product-form__button product-form__button--return',
          data: { turbolinks: false }
        %>
        <%= f.submit "#{@user_product.new_record? ? 'Agregar' : 'Editar'} producto", class: 'product-form__button product-form__button--submit' %>
      </div>
    <% end %>
  </div>
</div>
